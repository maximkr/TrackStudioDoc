<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/xsl" href="../helpproject.xsl" ?>
<topic template="Default" lasteditedby="Administrator" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="../helpproject.xsd">
  <title translate="true">Number of days since task update</title>
  <body>
    <header>
      <para styleclass="Heading1"><text styleclass="Heading1" translate="true">Number of days since task update</text></para>
    </header>
    <para styleclass="Normal" style="text-indent:48px; background-color:#ffffff; white-space:nowrap; page-break-inside:avoid;"><text styleclass="Normal" style="font-family:Verdana; font-size:12pt; vertical-align:baseline; color:#000000;" translate="true">Script returns the number of days since last update of the open task.</text></para>
    <para styleclass="Code Example"><text styleclass="Code Example" translate="true">package scripts.task_custom_field_value;</text><br/><text styleclass="Code Example" translate="true">import com.trackstudio.exception.GranException;</text><br/><text styleclass="Code Example" translate="true">import com.trackstudio.external.TaskUDFValueScript;</text><br/><text styleclass="Code Example" translate="true">import com.trackstudio.secured.SecuredTaskBean;</text><br/><text styleclass="Code Example" translate="true">import java.util.Calendar;</text><br/><text styleclass="Code Example" translate="true">/**</text><br/><text styleclass="Code Example" translate="true"> * Returns the number of days since last update of the open task.</text><br/><text styleclass="Code Example" translate="true"> * Task is considered to be closed which is in the final state.</text><br/><text styleclass="Code Example" translate="true"> * 0 is returned for it.</text><br/><text styleclass="Code Example" translate="true"> */</text><br/><text styleclass="Code Example" translate="true">public class DaysSinceUpdate implements TaskUDFValueScript {</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160;public Object calculate(SecuredTaskBean securedTaskBean) throws GranException {</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160;if (!securedTaskBean.getStatus().isFinish()) {</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;Calendar now = Calendar.getInstance();</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;now.set(Calendar.HOUR_OF_DAY, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;now.set(Calendar.MINUTE, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;now.set(Calendar.SECOND, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;now.set(Calendar.MILLISECOND, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;Calendar update = securedTaskBean.getUpdatedate();</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;update.set(Calendar.HOUR_OF_DAY, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;update.set(Calendar.MINUTE, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;update.set(Calendar.SECOND, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;update.set(Calendar.MILLISECOND, 0);</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;long l = now.getTimeInMillis() - update.getTimeInMillis();</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160; &#160; &#160;return (int) (l / (24 * 60 * 60 * 1000));</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160; &#160; &#160;} else return 0;</text><br/><text styleclass="Code Example" translate="true"> &#160; &#160;}</text><br/><text styleclass="Code Example" translate="true">}</text></para>
    <para styleclass="Normal" style="page-break-before:always;"></para>
  </body>
</topic>
